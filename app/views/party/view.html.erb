<header class="banner clearfix">
	<img class="profile" src="http://24.media.tumblr.com/tumblr_me3mb8GevE1qgxwpjo1_1280.jpg">
</header>
<div class="party-profile">
	<div class="party-header">
		<small>A party for</small>
		<h2><%= @party.name %> <%= link_to '', edit_party_path(@party.id), :class => 'icon-forward' if @is_party_owner %></h2>
	</div>
	<div class="party-info">
		<dl>
			<dt class="icon-user"></dt>
			<dd>Hosted by <%= @party.host %></dd>
			<dt class="icon-calendar"></dt>
			<dd><%= @party.date.strftime '%m/%e/%Y' %></dd>
			<dt class="icon-clock"></dt>
			<dd><%= "#{@party.time.strftime '%l:%M %p'} to #{@party.end_time.strftime '%l:%M %p'}" %></dd>
			<dt class="icon-location"></dt>
			<dd><%= @party.location.blank? ? 'Undisclosed' : @party.location %></dd>
		</dl>

		<div class="progress">
			<img src="/assets/piggy-bank.png" class="bank">
			<div class="fill" style="height: <%= @total_donation/@party.goal*100 %>%;"></div>
			<small>We've raised</small>
			<p id="donated"><span class="overlay"><%= number_to_currency @total_donation %></span></p>
			<small class="sub">Help us reach <span class="highlight overlay">$<%= number_to_currency @party.goal %></span></small>
		</div>	
	</div>

	<% unless @party.annoucements.empty? %>
	<h2>Announcements</h2>
	<% @party.annoucements.each do |annoucement| %>
	<section class="party announcement">
	<!-- 	<p>No recent announcement.</p> -->
		<p><% announcement.body %></p>
	</section>
	<% end %>
	<% end %>
	
	<section class="party guests">
		<h2>Guests</h2>
		<%= render 'guest/list' %>
		<% if @is_party_owner %>
		<div class="buttons">
			<div class="button left" id="email-guests">
				<%= link_to 'Email Guests', send_party_invites_path(@party.id) %>
			</div>
			<div class="button right" id="invite-guests">
				<%= link_to 'Invite Guests', add_guest_path(@party.id) %>
			</div>
		</div>
		<% end %>
	</section>
	
	<section class="party comments">
		<h2>Comments</h2>
		<% @party.comments.each do |comment| %>
		<div class="content-wrapper">
			<div class="comment">
				<div class="comment-header">
					<small><%= get_time_difference comment.date.to_time %></small>
					<span><%= comment.name %></span>
				</div>
				<p><%= comment.body %><% if @is_party_owner %><span class="icon-forward" title="Delete comment." alt="<%= comment.id %>"></span><% end %></p>
			</div>
		</div>
		<% end %>
		<form>
			<textarea class="comment-box" placeholder="Leave a comment!"></textarea>
			<input class="button right" type="submit" value="Add" id="comment-add">
		</form>
	</section>
</div>

<% @party.guests.each do |guest| %>
<div class="guest">
	<div class="left">
		<span class="left">Name</span>
		<span class="right"><%= "#{guest.name.blank? ? guest.email : guest.name}" %></span>
	</div>
	<%= form_for guest, :url => url_for(update_guest_path(guest.id, params[:id])) do |f| %>
		<div class="left">
			<span class="left">RSVP'd</span>
			<span class="right"><%= f.select :rsvp, [['Yes!', true], ['Not Yet', false]], :selected =>(guest.rsvp.blank? ? false : true) %></span>
		</div>
		<div class="left">
			<span class="left">Donation</span>
			<span class="right">$<%= f.number_field :donation %></span>
		</div>
		<%= f.submit 'Update', :class => 'button right' %>
	<% end %>
</div>
<% end if false #@is_party_owner %>

<script type="text/javascript">
$(function() {
	$('.comments .icon-forward').css('cursor', 'pointer').on('click', function(e) {
		$.post('/comment/<%= params[:id] %>/' + $(this).attr('alt')).done(function(data) {
			if (data === 'true')
				$(e.target).closest('.content-wrapper').remove();
		});
	});

	$('.comments form').on('submit', function(e) {
		e.preventDefault();

		$.post('/comment/<%= params[:id] %>', { body: $(this).children('.comment-box').val() }).done(function(data) {
			$(data).filter('.content-wrapper').insertAfter($('.party.comments .content-wrapper')[0] ? $('.party.comments .content-wrapper').last() : $('.party.comments h2'));
		});

		$(this).children('.comment-box').val('');
	});
});
</script>